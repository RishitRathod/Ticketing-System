<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Profile</title>
    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">


    <!-- CSS -->
    <style>
        body{
            background-color: #c9d6ff;
        }
        .nav-pills li a:hover {
            background-color: darkblue;
        }

        .dropdown-menu a:hover {
            background-color: darkblue;
            color: #fff;
        }
        fieldset {
            border: solid 1px gray;
            padding-top: 5px;
            padding-right: 12px;
            padding-bottom: 10px;
            padding-left: 12px;
            box-shadow:0 4px 8px 0 rgba(0, 0, 0, 0.2) ;
        }
        legend {
            float: none;
            width: inherit;
        }

        .main-content {
            max-width: 1000px;
            margin: 20px auto;  
            padding: 20px;
            /* background-color: #f9f9f9; */
            background: linear-gradient(to right, #bfbeff7e, #fffec075,#c6c0ff75);
            box-shadow:0 4px 6px 0 rgba(0, 0, 0, 0.5) ;
        }
        .main-content:hover{
            box-shadow:0 6px 9px 0 rgba(0, 0, 0, 0.5) ;
        }
        /* .pfp:hover{
            box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2) ;
        } */

        .sign {
            padding-top: 10px;
            color: #00111b;
            font-family: 'Ubuntu', sans-serif;
            font-weight: bold;
            font-size: 23px;
        }
        #accepted{
            display: none;
            background-color: rgb(161, 255, 161);
            text-shadow: 0 0 10px rgba(0, 255, 0, 0.5); 
            box-shadow: 0 0 10px 5px rgba(14, 187, 14, 0.5); 
            padding: 10px;
            border-radius: 5px; 
        }
        #pending{
            display:none;
            background-color: rgb(246, 255, 161);
            text-shadow: 0 0 10px rgba(229, 255, 0, 0.5); 
            box-shadow: 0 0 10px 5px rgba(158, 187, 14, 0.5); 
            padding: 10px;
            border-radius: 5px; 
        }
        #rejected{
            display: none;
            background-color: rgb(255, 161, 161);
            text-shadow: 0 0 10px rgba(255, 0, 0, 0.5); 
            box-shadow: 0 0 10px 5px rgba(187, 14, 14, 0.5); 
            padding: 10px;
            border-radius: 5px;  
        }
        .backOnav{
            background-color: #00023c;
        }
        .changeP{
            position: relative;
            left: 10vmin;
            bottom: 10vmin;
            background-color: #00023c;
            height: 7vmin;
            width: 7vmin;


        }
        
        #pfp{
            height: 30vmin;
            width: 30vmin;
        }
        .navLogo{
            height: 5vmax;
        }
        .navPf{
            height: 3vmax;
        }
        @media (min-width: 760px) {
            .sn{
                width:225px;   
            }
        }

    </style>
</head>
<body>
    <div class="container-fluid p-3 backOnav  text-white">
        <div class="row align-items-center">
            <a class="col-auto p-3 ml-md-3 g-0 ml-1 mr-auto" href="./organization_dashboard.html" style="text-decoration: none;">
                <img src="../img/logo.png" height="80" class="rounded-circle navLogo" alt="Logo">
                <b class="h5 ml-2 text-light text-decoration-none">The Organizer</b>
            </a>  
            <div class="col-auto g-0">
                <div class="dropdown open p-2 rounded-pills">
                    <button class="btn rounded-pill dropdown-toggle" type="button" id="triggerId" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <img src="../img/user.png" class="rounded-circle navPf" alt="User">
                    </button>
                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="triggerId">
                        <a class="dropdown-item " href="./org_profile.html">Profile</a>
                        <a class="dropdown-item" href="./organization_logout.php">Log Out</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>
    <div class="container-fluid">
        <div class="row flex-nowrap">
            <div class="backOnav col-auto col-xl-2 sn col-md-4 col-lg-3 min-vh-100 d-flex flex-column justify-content-between">
                <div class="backOnav">
                    <ul class="nav nav-pills flex-column">
                        <li class="nav-item py-2">
                            <a href="./organization_dashboard.php" class="nav-link text-white"> 
                                <i class="fs-5 fa fa-tachometer"></i> <span class="fs-5 ms-3 d-none d-sm-inline">Dashboard</span>
                            </a>
                        </li>
                        <li class="nav-item py-2">
                            <a href="./organization_events.php" class="nav-link text-white"> 
                                <i class="fs-5 fa fa-list"></i> <span class="fs-5 ms-3 d-none d-sm-inline">Events</span>
                            </a>
                        </li>
                        <li class="nav-item py-2">
                            <a href="./organization_plans.php" class="nav-link text-white"> 
                                <i class="fs-5 fa fa-th"></i> <span class="fs-5 ms-3 d-none d-sm-inline">Package</span>
                            </a>
                        </li>
                        <li class="nav-item py-2">
                            <a href="./organization_analysis.php" class="nav-link text-white"> 
                                <i class="fs-5 fa fa-clipboard"></i> <span class="fs-5 ms-3 d-none d-sm-inline">Analysis</span>
                            </a>
                        </li>
                        <li class="nav-item py-2">
                            <a href="./organization_members.php" class="nav-link text-white"> 
                                <i class="fs-5 fa fa-users"></i> <span class="fs-5 ms-3 d-none d-sm-inline">Members</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="modal fade" id="uploadNew" role="dialog">
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">Upload New Photo</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">

                          <span aria-hidden="true">&times;</span>
                        </button>
                      </div>
                      <div class="modal-body">
                        <form action="UploadPhoto.php" id="Upload" class="Upload" method="post" enctype="multipart/form-data">
                            <input type="file" id="photoInput" name="file" accept="image/*">
                              <input type="hidden" name="OrgID" value="" id="OrgID1"> 
                      </div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        <button type="submit" onclick="updateProfile(event)" class="btn btn-primary">Save changes</button>
                    </form>
                      </div>
                  </div>
                </div>
              </div>
            <div class="col p-3">
                <div class="main-content mx-auto d-flex justify-content-center align-items-center rounded-5">
                    <form id="registrationForm" class="form-container justify-content-center flex-wrap" action="" method="POST" id="editForm"> 
                        <p class="sign" align="center">Profile</p>
                        <div class="d-flex flex-column align-items-center mb-3">
                            <img src="../img/user.png" height="180" id="pfp" alt="../img/user.png   " class="shadow-lg p-2 bg-body-tertiary rounded-circle">
                            <button type="button" class="changeP rounded-5 mt-2" id="changeP" data-toggle="modal" data-target="#uploadNew"><i class="fa fa-pencil text-light"></i></button>                         </div>
                        <fieldset class="mt-3 px-5 rounded-4">
                            <legend> Status </legend>
                            <div class="my-3 mx-3 text-black" id="status">
                                <div id="accepted"> 
                                    <i class="fs-5 fa fa-check mr-2 mx-4"></i>Approved
                                </div>
                                <div id="pending">  
                                    <i class="fs-5 fa fa-clock-os mr-2 mx-4"></i>Pending
                                </div>
                                <div id="rejected"> 
                                    <i class="fs-5 fa fa-warning mr-2 mx-4"></i>Rejected
                                    <p class="" id="reason"></p>
                                </div>
                            </div>
                        </fieldset>
                        <fieldset class="mt-3 p-4 rounded-4">
                            <legend>Organization Details</legend>
                            <div class="row">
                                <div class="col">
                                <label for="name" class="ml-3"> Organization Name </label>
                                <input type="text" name="name" id="name" class="my-2 m-sm-1 form-control" disabled> 
                            </div>
                            <!-- <div class="col">
                                <label for="desc" class="ml-3"> Package </label>
                                <input type="text" name="package" id="package" class="my-2 m-sm-1 form-control" disabled>
                            </div> -->
                        </div>
                        <label for="email"> Email </label>
                            <input type="email" name="email" id="email" class="form-control" disabled>
                            <label for="pass"> Password </label>
                            <input type="text" name="pass" id="pass" class="form-control" disabled> 
                        </fieldset>
    
                        <fieldset class="m-auto mt-3 px-4 rounded-4">
                            <legend>  Contact Details </legend>
                            <div class="row">
                                <div class="col-12">
                                    <label for="co_name" class="m-3"> Name </label>
                                    <input type="text" name="co_name" id="co_name" class="form-control" disabled>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col my-2">
                                    <label for="co_email" class="m-3"> Email </label>
                                    <input type="email" name="co_email" id="co_email"  class="form-control"disabled>
                                </div>
                                <div class="col my-2">
                                    <label for="co_number" class="m-3"> Number </label>
                                    <input type="text" name="co_number" id="co_number" class="form-control" disabled>
                                </div>
                            </div>
                        <div id="displayLocationdiv">
                           <div class="row"> <div class="col my-2">
                                <label for="Country" class="m-3"> Country </label>
                                <input type="text" onblur="type='text'" name="Country" id="Country" class="form-control" disabled>
                            </div>
                            <div class="col my-2">
                                <label for="State" class="m-3"> State </label>
                                <input type="text" onblur="type='text'" name="co_nStateumber" id="State" class="form-control" disabled>
                            </div>
                            <div class="col my-2">
                                <label for="City" class="m-3"> City </label>
                                <input type="text" onblur="type='text'" name="City" id="City" class="form-control" disabled>
                            </div>
                        </div>
                                <div class="container" id="selectLocaitonDiv">
                                    <div class="form-group row">
                                        <div class="col-4">
                                            <label for="country1">Country<span class="req">*</span></label>
                                             <select name="Country1" id="country1" class="form-control" required> 
                                                 <option value="" selected="Selected">Select Country</option>
                                             </select>
                                        </div>
                                        <div class="col-4">
                                            <label for="state1">State<span class="req">*</span></label> 
                                            <select name="State1" id="state1" class="form-control" required> 
                                                <option value="" selected="Selected">Select State</option>
                                            </select>
                                        </div>
                                        <div class="col-4">
                                            <label for="city1">City <span class="req">*</span></label> 
                                            <select name="City1" id="city1" class="form-control" required> 
                                                <option value="" selected="Selected">Select City</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                       

                            <div class="col my-2">
                                <label for="Address" class="m-3"> Address </label>
                                <input type="text" name="Address" id="Address" class="form-control" disabled>
                            </div>
                            
                        </fieldset>
                       
                        <input type="hidden" id="OrgID" name="OrgID">
                        <div class="row justify-content-center">
                            <button type="button" id="edit" name="edit" class="col-2 m-auto mt-3 btn btn-outline-primary" onclick="editProfile()">Edit</button>
                            <button type="submit" id="submit" name="submit" class="col-2 m-auto mt-3 btn btn-outline-warning" onclick="updateprofile()" hidden>Submit</button>
                        </div>
                    </form>  
     
                </div>
            </div>
        </div>
    </div>  


    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>   

    <footer class="bg-body-tertiary p-3 text-center text-lg-start">
    <!-- Copyright -->
        <div class="text-center p-3" style="background-color: rgba(0, 0, 0, 0.05);">
            © 2024 Copyright:
            <a class="text-body" href="#"> Event Scheduler </a>
        </div>
    <!-- Copyright -->
    </footer>
    <script>
        function updateProfile(event){
            event.preventDefault()
            const form = document.querySelector('#Upload');
            const formData = new FormData(form);
            document.getElementById('OrgID1').value = userData[0].OrgID;
            form.submit();

        }
    </script>
    <script src="../script.js"></script>
    <script>
        $('#uploadNew').on('shown.bs.modal', function () {
            $('#myInput').trigger('focus')
        })
    </script>
    <script>
        const OrgID = document.cookie.split('; ').find(row => row.split('=')[0] === 'id').split('=')[1];
        const data1 ={
            OrgID: OrgID,
            action : "FetchOrgDetails" 
        };
        async function getUser() {
    try {
        const response = await fetch('../fetchOrgs.php', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data1),       
        });
        const data = await response.json();
        console.log(data);
        return data;
    } catch (error) {
        console.error('Error fetching user data:', error);
        return null;
    }
}
        let userData;
        let status; 
        let resasonofrejection;
        document.addEventListener("DOMContentLoaded", function() {
            fetch('../cascading.php') 
                .then(response => response.json())
                .then(data => {
                    const countrySel = document.getElementById("country1");
                    const stateSel = document.getElementById("state1");
                    const citySel = document.getElementById("city1");

                    let countries = {};

                    data.forEach(item => {
                        if (!countries[item.country]) {
                            countries[item.country] = {};
                        }
                        if (!countries[item.country][item.state]) {
                            countries[item.country][item.state] = [];
                        }
                        countries[item.country][item.state].push(item.city);
                    });

                    for (let country in countries) {
                        let option = new Option(country, country);
                        countrySel.add(option);
                    }

                    countrySel.onchange = function() {
                        stateSel.length = 1;
                        citySel.length = 1;
                        let selectedCountry = this.value;
                        if (selectedCountry && countries[selectedCountry]) {
                            for (let state in countries[selectedCountry]) {
                                let option = new Option(state, state);
                                stateSel.add(option);
                            }
                        }
                    }

                    stateSel.onchange = function() {
                        citySel.length = 1;
                        let selectedCountry = countrySel.value;
                        let selectedState = this.value;
                        if (selectedState && countries[selectedCountry] && countries[selectedCountry][selectedState]) {
                            countries[selectedCountry][selectedState].forEach(city => {
                                let option = new Option(city, city);
                                citySel.add(option);
                            });
                        }
                    }
                });
        });

        document.addEventListener('DOMContentLoaded', async function() {
           document.getElementById('selectLocaitonDiv').style.display = 'none';
            userData = await getUser();
        //  console.log(userData);
      //         console.log(userData.data[0].OrgID);
            const data = userData.data[0];
            console.log(data);
            showDiv(data.Status);
            
            if (data || data.length > 0) {
                //console.log("in the if statement");
                document.getElementById('name').value = data.OrganizationName;
                document.getElementById('email').value = data.OrganizationEmail;
                document.getElementById('pass').value = document.cookie.split('; ').find(row => row.startsWith('password')).split('=')[1];
                document.getElementById('co_email').value = data.OrganizationContactEmail;
                document.getElementById('co_number').value = data.OrganizationContactNumber;
                document.getElementById('co_name').value = data.OrganizationName;
                document.getElementById('OrgID').value = data.OrgID;
                document.getElementById('pfp').src = data.OrganizationPhoto;
                //document.getElementById('co_name').value = userData[0].ContactName;
                document.getElementById('Country').value = data.OrganizationCountry;
                document.getElementById('State').value = data.OrganizationState;
                document.getElementById('City').value = data.OrganizationCity;
                document.getElementById('Address').value = data.OrganizationAddress;


                status = data.Status;
                resasonofrejection= data.ReasonOfRejection;
            }
        });

        function editProfile() {
            document.getElementById('submit').removeAttribute('hidden');
            document.getElementById('name').removeAttribute('disabled');
            document.getElementById('co_email').removeAttribute('disabled');
            document.getElementById('co_number').removeAttribute('disabled');
            document.getElementById('co_name').removeAttribute('disabled');
            document.getElementById('OrgID').removeAttribute('hidden');
            document.getElementById('Address').removeAttribute('disabled');
            document.getElementById('displayLocationdiv').style.display = 'none';
        //    console.log("before excecutingg stle block");
       //    document.getElementById('selectLocationDiv').removeAttribute('hidden');
            document.getElementById('selectLocaitonDiv').style.display = 'block';
            document.getElementById('Country').removeAttribute('disabled');
            document.getElementById('State').removeAttribute('disabled');
            document.getElementById('City').removeAttribute('disabled');
            

                
            


        }

        function updateprofile() {
            // Hide the submit button
            document.getElementById('submit').setAttribute('hidden', 'true');
            document.getElementById('name').setAttribute('disabled', 'true');
            document.getElementById('co_email').setAttribute('disabled', 'true');
            document.getElementById('co_number').setAttribute('disabled', 'true');
            document.getElementById('co_name').setAttribute('disabled', 'true');
            document.getElementById('OrgID').setAttribute('hidden', 'true');
            document.getElementById('Country').setAttribute('disabled', 'true');
            document.getElementById('State').setAttribute('disabled', 'true');
            document.getElementById('City').setAttribute('disabled', 'true');
            document.getElementById('Address').setAttribute('disabled', 'true');
           
    
            
            // Prevent the default form submission behavior
            event.preventDefault();
            
            // Get the form data
            const name = document.querySelector("#name").value;
            const contactName = document.querySelector("#co_name").value;
            const contactNumber = document.querySelector("#co_number").value;
            const contactEmail = document.querySelector("#co_email").value;
            const orgID = document.querySelector("#OrgID").value;
            const country = document.getElementById("country1").value;
            const state = document.getElementById("state1").value;
            const city = document.getElementById("city1").value;
            const address = document.querySelector("#Address").value;
            
            

            // Construct the data object
            var data = {
                "Name": name,
                "ContactName": contactName,
                "ContactNumber": contactNumber,
                "ContactEmail": contactEmail,
                "Tablename": "organizations",
                "OrgID": orgID,
                "Country": country,
                "State": state,
                "City": city,
                "Address": address
        };
        console.log(data);
        
        // Send the form data to the server
        fetch("org_profile.php", {
            method: "POST",
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data),
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(data => {
            console.log('Response from server:', data);
            // Handle the response data here
        })
        .catch(error => {
            console.error('Error:', error);
        });
    }

    function showDiv(status) {
      if (status === "Pending") {
        document.getElementById('pending').style.display = 'block';
      } else if (status === "Rejected") {
        document.getElementById('rejected').style.display = 'block';
      } else {
        document.getElementById('accepted').style.display = 'block';
      }
    }



    
    
    </script>

</body>
</html>